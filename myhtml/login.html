<html>
  <head>
  	<meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
  	<title>PsyChoProj: Play</title>
  </head>

<body>
	<!--登陸層-->
	<div id="loginDiv" class="dlbj">
	<!--127.0.0.1 is localhost -->
	<p>Username</p>
	<div><input id="tUser" type="text" name="textfield"></div>
	<div class="dlfwq" id="btnCon"><img src="http://www.gifs.cc/enter/enter-with-frame.png"  border="0"></div>
	</div>
</body>

    <script src="/socket.io/socket.io.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

<script>
(function(){

  var Client = {
 
    so:null,
	isFirstConnect:true,

	user:{"uname":null},
  };

  Client.connect = function(host,port){
     var p = port||80,
	     self = this;
	 if(this.so==null)
	 {
         this.so = io.connect("http://"+host+":"+p,{'reconnect':false});
		 if(this.so)
		 {		   
		
		   this.so.on("connect",function(){self.doConnect();});		 
		   this.so.on("error",function(data){this.so = null ; alert("Connection failed!");});
		 }
	 }
	 else
	 {
	     this.so.socket.reconnect();
	 }
  };
 
  Client.login = function(callback)
  {
 
	  this.so.emit("login",{"uname":this.user.uname},function(data){
         callback(data);
	  });
  };

  Client.doConnect = function()
  {   
	
	 if(this.isFirstConnect)
	 {
		this.isFirstConnect = false;
		this.bindEvent();
	 }
	 else
	 {
		this.so.socket.reconnect();
	 }
  };
  Client.bindEvent = function()
  {
     var self = this;
	 this.so.on("message",function(msg){self.doMessage(msg);});
  };  
  window.Client = Client;
}())

function isSupportHTML5()
{
	return (typeof(Worker) !=="undefined");
}
$(document).ready(function(){
	if(!isSupportHTML5())
	{
		alert("Your browser does not support HTML5!");
	}
	else
	{
		$("#btnCon").click(function(){
			//need to modify to my own host
			//var host = $("#host").val(),
			var host = '140.112.249.166',
			    user = $("#tUser").val();
			Client.connect(host,8888);
			Client.user.uname = user ; 
			Client.login(function(data){
				if(data==1)
				{
					alert("This user already exist, please change user!");
				}
				else
				{
					$("#loginDiv").hide();
					$("#main").show();
				}
			});
		});
	}
})
</script>
</html>
